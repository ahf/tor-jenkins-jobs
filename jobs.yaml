- defaults:
    name: global
    description: 'Do not edit this job through the web'
    project-type: matrix
    scm:
       - git:
           url: "{git-url}"
           basedir: source
    execution-strategy:
        sequential: true
        touchstone:
            expr: '(ARCHITECTURE=="amd64")'
            result: stable
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - squeeze
                - wheezy
                - lucid
                - natty
                - oneiric
                - precise
                - quantal
                - sid
    logrotate:
        daysToKeep: -1
        numToKeep: 5
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    wrappers:
        - timestamps

# our actual projects
- job:
    name: tor-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
                - maint-0.2.3
                - maint-0.2.4
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    triggers:
        - pollscm: "*/10 * * * *"
    publishers:
        - archive:
            artifacts: "src/or/tor"
- job:
    name: tor-ci-linux-clang
    project-type: matrix
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
                - maint-0.2.3
                - maint-0.2.4
    builders:
        - shell: "SUITE=sid /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    triggers:
        - pollscm: "*/10 * * * *"

# our actual projects
- job:
    name: stem-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/stem.git'
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    triggers:
        - pollscm: "*/10 * * * *"

- job:
    name: tor-ci-stem-base
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
    builders:
        - shell: "SUITE=squeeze ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    triggers:
        - pollscm: "*/10 * * * *"
    publishers:
        - archive:
            artifacts: "src/or/tor"
        - trigger:
            project: tor-stem-ci

- job:
    name: tor-stem-ci
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/stem.git'
            branches:
                - master
    builders:
        - copyartifact:
            project: tor-ci-stem-base
            which-build: "last-successful"
        - shell: "SUITE=squeeze ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - email-ext:
                recipients: atagar@torproject.org
                subject: Build ${BUILD_NUMBER} of tor-stem-ci failed - log attached
                body: ${BUILD_LOG, maxLines=9999, escapeHtml=false}
    triggers:
        - pollscm: "*/10 * * * *"

- job:
    name: extern-windows-libevent
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/libevent.git'
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    triggers:
        - pollscm: "20 * * * *"
    publishers:
        - archive:
            artifacts: "RESULT-libevent.tar.gz"
- job:
    name: extern-windows-openssl
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/openssl.git'
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    triggers:
        - pollscm: "25 * * * *"
    publishers:
        - archive:
            artifacts: "RESULT-openssl.tar.gz"
- job:
    name: extern-windows-zlib
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/zlib.git'
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    triggers:
        - pollscm: "30 * * * *"
    publishers:
        - archive:
            artifacts: "RESULT-zlib.tar.gz"
