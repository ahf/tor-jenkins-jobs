- defaults:
    name: global
    description: 'Do not edit this job through the web'
    project-type: matrix
    block-upstream: true
    scm:
       - git:
           url: "{git-url}"
           basedir: source
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="wheezy")'
            result: stable
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - squeeze
                - wheezy
                - jessie
                - sid
                - lucid
                - precise
                - saucy
                - trusty
    logrotate:
        daysToKeep: -1
        numToKeep: 5
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    wrappers:
        - workspace-cleanup:
            include:
              - "**"
        - timestamps
        - timeout:
            timeout: 600
            fail: true
        - matrixtieparent:
            labelname: master
    publishers:
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT

# our actual projects
###############################################################
### tor
###############################################################
- job:
    name: tor-ci-linux-master
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-ci-linux-0.2.3
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - maint-0.2.3
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-ci-linux-0.2.4
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - maint-0.2.4
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-ci-linux-master-clang
    project-type: matrix
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="sid")'
            result: stable
        #combination-filter: '(ARCHITECTURE=="amd64" || SUITE=="experimental")'
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - sid
                #- experimental
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
- job:
    name: tor-ci-linux-0.2.3-clang
    project-type: matrix
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="sid")'
            result: stable
        #combination-filter: '(ARCHITECTURE=="amd64" || SUITE=="experimental")'
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - sid
                #- experimental
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - maint-0.2.3
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
- job:
    name: tor-ci-linux-0.2.4-clang
    project-type: matrix
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="sid")'
            result: stable
        #combination-filter: '(ARCHITECTURE=="amd64" || SUITE=="experimental")'
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - sid
                #- experimental
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - maint-0.2.4
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
- job:
    name: tor-ci-windows
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
                - maint-0.2.3
                - maint-0.2.4
            basedir: tor
    builders:
        - copyartifact:
            project: extern-windows-libevent
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-openssl
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.tor.tar.gz"
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT

#### nightly .debs: master
- job:
    name: tor-debian-master-nightly-source
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
            basedir: tor
        - git:
            url: 'https://git.torproject.org/debian/tor.git'
            branches:
                - master
            basedir: debian-tor
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-master-nightly-binaries
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-master-nightly-binaries
    node: Linux
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="wheezy")'
            result: stable
        #combination-filter: '(SUITE!="lucid")'
    scm:
        - none:
    builders:
        - copyartifact:
            project: tor-debian-master-nightly-source
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/tor-debian-master-nightly-binaries"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-master-nightly-install
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-master-nightly-install
    project-type: freestyle
    node: master
    scm:
        - none
    builders:
        - shell: 'true'
        - copyartifact:
            project: tor-debian-master-nightly-binaries
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "rsync -v incoming/*/* tordeb@palmeri.torproject.org:-overridden-server-side- && ssh tordeb@palmeri.torproject.org dinstall"

#### nightly .debs: 0.2.4.x
- job:
    name: tor-debian-024-nightly-source
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - maint-0.2.4
                - release-0.2.4
            basedir: tor
        - git:
            url: 'https://git.torproject.org/debian/tor.git'
            branches:
                - debian-0.2.4
            basedir: debian-tor
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-024-nightly-binaries
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-024-nightly-binaries
    node: Linux
    scm:
        - none:
    builders:
        - copyartifact:
            project: tor-debian-024-nightly-source
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/tor-debian-master-nightly-binaries"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-024-nightly-install
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-024-nightly-install
    project-type: freestyle
    node: master
    scm:
        - none
    builders:
        - shell: 'true'
        - copyartifact:
            project: tor-debian-024-nightly-binaries
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "rsync -v incoming/*/* tordeb@palmeri.torproject.org:-overridden-server-side- && ssh tordeb@palmeri.torproject.org dinstall"
#### nightly .debs: 0.2.3.x
- job:
    name: tor-debian-023-nightly-source
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - maint-0.2.3
                - release-0.2.3
            basedir: tor
        - git:
            url: 'https://git.torproject.org/debian/tor.git'
            branches:
                - debian-0.2.3
            basedir: debian-tor
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-023-nightly-binaries
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-023-nightly-binaries
    node: Linux
    scm:
        - none:
    builders:
        - copyartifact:
            project: tor-debian-023-nightly-source
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/tor-debian-master-nightly-binaries"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-023-nightly-install
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-023-nightly-install
    project-type: freestyle
    node: master
    scm:
        - none
    builders:
        - shell: 'true'
        - copyartifact:
            project: tor-debian-023-nightly-binaries
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "rsync -v incoming/*/* tordeb@palmeri.torproject.org:-overridden-server-side- && ssh tordeb@palmeri.torproject.org dinstall"
#### .debs: release builds
- job:
    name: tor-debian-release-source
    project-type: freestyle
    parameters:
        - string:
            name: "DEBIAN_VERSION"
            description: "debian version to build"
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/debian/tor.git'
            basedir: debian
            branches:
                - "master"
        - git:
            url: 'https://git.torproject.org/debian/tor-pristine-upstream.git'
            basedir: pristine-upstream
            branches:
                - "master"
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper DEBIAN_VERSION"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-release-binaries
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-release-binaries
    node: Linux
    scm:
        - none:
    builders:
        - copyartifact:
            project: tor-debian-release-source
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/tor-debian-master-nightly-binaries"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-release-install
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tor-debian-release-install
    project-type: freestyle
    node: master
    scm:
        - none
    builders:
        - shell: 'true'
        - copyartifact:
            project: tor-debian-release-binaries
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "rsync -v incoming/*/* tordeb@palmeri.torproject.org:-overridden-server-side- && ssh tordeb@palmeri.torproject.org dinstall"
###############################################################
### libevent
###############################################################
- job:
    name: libevent-master-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/mirror/libevent.git'
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper CONFIGURE_VERBOSE_DEBUG CONFIGURE_THREAD_SUPPORT CONFIGURE_MALLOC_REPLACEMENT CONFIGURE_OPENSSL CONFIGURE_DEBUG_MODE"
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="wheezy" && CONFIGURE_VERBOSE_DEBUG=="yes-verbose-debug" && CONFIGURE_THREAD_SUPPORT=="yes-thread-support" && CONFIGURE_MALLOC_REPLACEMENT=="yes-malloc-replacement" && CONFIGURE_OPENSSL=="yes-openssl" && CONFIGURE_DEBUG_MODE=="yes-debug-mode" )'
            result: stable
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - wheezy
        - axis:
            type: text
            name: CONFIGURE_VERBOSE_DEBUG
            values:
                - yes-verbose-debug
                - no-verbose-debug
        - axis:
            type: text
            name: CONFIGURE_THREAD_SUPPORT
            values:
                - yes-thread-support
                - no-thread-support
        - axis:
            type: text
            name: CONFIGURE_MALLOC_REPLACEMENT
            values:
                - yes-malloc-replacement
                - no-malloc-replacement
        - axis:
            type: text
            name: CONFIGURE_OPENSSL
            values:
                - yes-openssl
                - no-openssl
        - axis:
            type: text
            name: CONFIGURE_DEBUG_MODE
            values:
                - yes-debug-mode
                - no-debug-mode
- job:
    name: libevent-master-ci-windows
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/mirror/libevent.git'
            branches:
                - master
    builders:
        - shell: "ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper CONFIGURE_HOST"
    execution-strategy:
        touchstone:
            expr: '(CONFIGURE_HOST=="x86_64-w64-mingw32")'
            result: stable
    axes:
        - axis:
            type: label-expression
            name: SUITE
            values:
                - wheezy
        - axis:
            type: text
            name: CONFIGURE_HOST
            values:
                - i686-w64-mingw32
                - x86_64-w64-mingw32
    publishers:
        - archive:
            artifacts: "test/*.exe, test/test.sh"
        - trigger:
            project: libevent-master-ci-windows-test
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: libevent-master-ci-windows-test
    project-type: freestyle
    node: windows
    scm:
        - none:
    builders:
        - copyartifact:
            project: libevent-master-ci-windows
            which-build: "upstream-build"
            fallback-to-last-successful: true
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
###############################################################
### tlsdate
###############################################################
- job:
    name: tlsdate-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tlsdate.git'
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
###############################################################
### torsocks
###############################################################
- job:
    name: torsocks-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/torsocks.git'
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
###############################################################
### vidalia
###############################################################
- job:
    name: vidalia-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/vidalia.git'
            branches:
                - master
                - maint-0.2.3
                - maint-0.2.4
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
- job:
    name: vidalia-ci-windows
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/vidalia.git'
            branches:
                - master
    builders:
        - copyartifact:
            project: extern-windows-qt
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.vidalia.tar.gz"
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT

###############################################################
### stem
###############################################################
- job:
    name: stem-ci-linux
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/stem.git'
            branches:
                - master
    execution-strategy:
        sequential: true
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="wheezy")'
            result: stable
        combination-filter: '(SUITE!="squeeze" && SUITE!="lucid" && SUITE!="precise")'
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

- job:
    name: stem-tor-ci-base
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            branches:
                - master
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "build-tree-tor/src/or/tor"
        - trigger:
            project: stem-tor-ci
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT

- job:
    name: stem-tor-ci
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/stem.git'
            branches:
                - master
    builders:
        - copyartifact:
            project: stem-tor-ci-base
            which-build: "last-successful"
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - email-ext:
                recipients: atagar@torproject.org
                subject: Build ${BUILD_NUMBER} of stem-tor-ci failed - log attached
                body: ${BUILD_LOG, maxLines=9999, escapeHtml=false}
###############################################################
### obfsproxy and friends
###############################################################
- job:
    name: pyptlib-ci-linux
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/pluggable-transports/pyptlib'
            branches:
                - master
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT.pyptlib.tar.gz"
        - trigger:
            project: obfsproxy-ci-linux
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: obfsproxy-ci-linux
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/pluggable-transports/obfsproxy'
            branches:
                - master
                - test_2_021
    builders:
        - copyartifact:
            project: pyptlib-ci-linux
            which-build: "last-successful"
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

###############################################################
### external libraries
###############################################################
- job:
    name: extern-windows-libevent
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/libevent.git'
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.libevent.tar.gz"
        - trigger:
            project: tor-ci-windows
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: extern-windows-openssl
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/openssl.git'
            branches:
                - master
    builders:
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.openssl.tar.gz"
        - trigger:
            project: tor-ci-windows
        - trigger:
            project: extern-windows-qt
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: extern-windows-qt
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/qt.git'
            branches:
                - master
    builders:
        - copyartifact:
            project: extern-windows-openssl
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.qt.tar.gz"
        - trigger:
            project: vidalia-ci-windows
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: extern-windows-zlib
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/zlib.git'
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.zlib.tar.gz"
        - trigger:
            project: extern-windows-openssl
        - trigger:
            project: extern-windows-qt
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tb-manual
    project-type: freestyle
    node: dixie.torproject.org
    scm:
        - git:
            url: 'https://git.torproject.org/tor-browser/user-manual.git'
            basedir: user-manual
            branches:
                - "master"
        - git:
            url: 'https://git.torproject.org/builders/tor-browser-bundle.git'
            basedir: tor-browser-bundle
            branches:
                - "master"
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/html.tar.gz"
        - trigger:
            project: tb-manual-install
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkings build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT
- job:
    name: tb-manual-install
    project-type: freestyle
    node: master
    scm:
        - none
    builders:
        - shell: 'true'
        - copyartifact:
            project: tb-manual
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "cat incoming/html.tar.gz | ssh torwww@staticiforme.torproject.org jenkins-tb-manual"
