###############################################################
### tor browser manual
###############################################################
- job:
    name: tb-manual
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor-browser/user-manual.git'
            fastpoll: true
            basedir: user-manual
            branches:
                - "master"
        - git:
            url: 'https://git.torproject.org/builders/tor-browser-bundle.git'
            fastpoll: true
            basedir: tor-browser-bundle
            branches:
                - "master"
    builders:
        - shell: "SUITE=stretch ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/html.tar.gz"
        - email-ext:
                recipients: colin@torproject.org
                subject: Build ${BUILD_NUMBER} of tb-manual failed - log attached
                body: ${BUILD_LOG, maxLines=9999, escapeHtml=false}
        - trigger:
            project: tb-manual-install
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: tb-manual-install
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: tb-manual
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "cat incoming/html.tar.gz | ssh torwww@staticiforme.torproject.org jenkins-tb-manual"

- job:
    name: tb-manual-alpha
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor-browser/user-manual.git'
            fastpoll: true
            basedir: user-manual
            branches:
                - "alpha"
        - git:
            url: 'https://git.torproject.org/builders/tor-browser-bundle.git'
            fastpoll: true
            basedir: tor-browser-bundle
            branches:
                - "master"
    builders:
        - shell: "SUITE=stretch ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/html.tar.gz"
        - email-ext:
                recipients: colin@torproject.org
                subject: Build ${BUILD_NUMBER} of tb-manual failed - log attached
                body: ${BUILD_LOG, maxLines=9999, escapeHtml=false}
        - trigger:
            project: tb-manual-install-alpha
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: tb-manual-install-alpha
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: tb-manual
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "cat incoming/html.tar.gz | ssh torwww@staticiforme.torproject.org jenkins-tb-manual-alpha"
