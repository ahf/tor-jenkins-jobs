- publisher:
    name: notify-tor-irc
    publishers:
        - email-ext:
                recipients: tor-jenkins@commit.noreply.org
                subject: Tor Jenkins build status
                body: |
                      project: $PROJECT_NAME
                      build: $BUILD_NUMBER
                      status: $BUILD_STATUS
                      url: $BUILD_URL
                unstable: true
                first-failure: true
                not-built: true
                #aborted: true
                regression: true
                failure: true
                improvement: true
                still-failing: true
                #success: true
                fixed: true
                still-unstable: true
                #pre-build: true
                matrixTriggerMode: ONLY_PARENT

- publisher:
    name: post-workspace-cleanup
    publishers:
        - workspace-cleanup:
            dirmatch: true
            include:
              - "**"

- combination-filter-openssl11restriction: &combination-filter-openssl11restriction
    # This is for jobs that want to avoid building tor prior to 0.2.8.x on OSs that do ship with openssl 1.1.x
    name: combination-filter-openssl11restriction
    combination-filter: '( ("{version}" != "0.2.5") && ("{version}" != "0.2.6") && ("{version}" != "0.2.7")) || ( (SUITE != "sid") && (SUITE != "stretch") )'

- execution-strategy-openssl11restriction: &execution-strategy-openssl11restriction
    # This is for jobs that want to avoid building tor prior to 0.2.8.x on OSs that do ship with openssl 1.1.x
    name: execution-strategy-openssl11restriction
    execution-strategy:
      sequential: false
      touchstone:
        expr: '(ARCHITECTURE=="amd64" && SUITE=="jessie")'
        result: stable
      <<: *combination-filter-openssl11restriction

- defaults:
    name: global
    description: 'Do not edit this job through the web'
    project-type: matrix
    block-upstream: true
    node: master
    scm:
       - git:
           url: "{git-url}"
           basedir: source
    triggers:
       - pollscm:
           cron: "17 1 * * *"
           ignore-post-commit-hooks: False
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="amd64" && SUITE=="jessie")'
            result: stable
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - wheezy
                - jessie
                - stretch
                - sid
                - precise
                - trusty
                - xenial
                - yakkety
    logrotate:
        daysToKeep: -1
        numToKeep: 5
        artifactDaysToKeep: -1
        artifactNumToKeep: -1
    wrappers:
        - workspace-cleanup:
            include:
              - "**"
        - timestamps
        - timeout:
            timeout: 600
            fail: true
    publishers:
        - notify-tor-irc
        - post-workspace-cleanup

# our actual projects
###############################################################
### tor
###############################################################
- project:
    name: tor-ci-linux
    version:
      - master:
          branch_name: '{version}'
          debian_upstream_release_branch: '{version}'
          debian_branch: '{version}'
      - 0.2.5:
          branch_name: 'maint-{version}'
          debian_upstream_release_branch: 'release-{version}'
          debian_branch: 'debian-{version}'
      - 0.2.6:
          branch_name: 'maint-{version}'
          debian_upstream_release_branch: 'release-{version}'
          debian_branch: 'debian-{version}'
      - 0.2.7:
          branch_name: 'maint-{version}'
          debian_upstream_release_branch: 'release-{version}'
          debian_branch: 'debian-{version}'
      - 0.2.8:
          branch_name: 'maint-{version}'
          debian_upstream_release_branch: 'release-{version}'
          debian_branch: 'debian-{version}'
      - 0.2.9:
          branch_name: 'maint-{version}'
          debian_upstream_release_branch: 'release-{version}'
          debian_branch: 'debian-{version}'
    jobs:
      - 'tor-ci-linux-{version}'
      - 'tor-ci-linux-{version}-extra-arm'
      - 'tor-ci-linux-{version}-clang'
      - 'tor-ci-mingwcross-{version}'
      - 'tor-ci-mingwcross-{version}-test'
      - 'tor-ci-mingwcross-{version}-test-native'
      - 'tor-ci-windows-{version}'
      - 'tor-ci-freebsd-amd64-{version}'
      - 'tor-debian-{version}-nightly-source'
      - 'tor-debian-{version}-nightly-binaries'
      - 'tor-debian-{version}-nightly-install'

- project:
    name: tor-ci-linux-variants
    version:
      - master:
          branch_name: '{version}'
          debian_upstream_release_branch: '{version}'
          debian_branch: '{version}'
    jobs:
      - 'tor-ci-linux-{version}-expensive-hardening'
      - 'tor-ci-linux-{version}-tor2webmode'

#- project:
#    name: tor-ci-linux-experimental
#    version:
#      - master:
#          branch_name: '{version}'
#          debian_upstream_release_branch: '{version}'
#          debian_branch: '{version}'
#      - 0.2.8:
#          branch_name: 'maint-{version}'
#          debian_upstream_release_branch: 'release-{version}'
#          debian_branch: 'master'
#      - 0.2.9:
#          branch_name: 'maint-{version}'
#          debian_upstream_release_branch: 'release-{version}'
#          debian_branch: 'master'
#    type:
#      - openssl
#    jobs:
#      - 'tor-ci-linux-{version}-exp-{type}'


- job-template:
    name: 'tor-ci-linux-{version}'
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - '{branch_name}'
        - git:
            url: 'https://git.torproject.org/fuzzing-corpora.git'
            fastpoll: true
            branches:
                - master
            basedir: fuzzing-corpora
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    <<: *execution-strategy-openssl11restriction
    publishers:
        - trigger:
            project: 'tor-ci-linux-{version}-extra-arm'
        - trigger:
            project: 'tor-ci-freebsd-amd64-{version}'
        - notify-tor-irc
        - post-workspace-cleanup

- job-template:
    name: 'tor-ci-linux-{version}-expensive-hardening'
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - '{branch_name}'
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

- job-template:
    name: 'tor-ci-linux-{version}-tor2webmode'
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - '{branch_name}'
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

- job-template:
    name: 'tor-ci-linux-{version}-extra-arm'
    scm: []
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="armhf" && SUITE=="jessie")'
            result: stable
        <<: *combination-filter-openssl11restriction
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - armhf
                - armel
        - axis:
            type: label-expression
            name: SUITE
            values:
                - jessie
                - sid

- job-template:
    name: 'tor-ci-linux-{version}-clang'
    project-type: matrix
    execution-strategy:
        sequential: false
        touchstone:
            expr: '(ARCHITECTURE=="i386" && SUITE=="sid")'
            result: stable
        #combination-filter: '(ARCHITECTURE=="amd64" || SUITE=="experimental")'
        <<: *combination-filter-openssl11restriction
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - sid
                #- experimental
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - '{branch_name}'
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

#- job-template:
#    name: 'tor-ci-linux-{version}-exp-{type}'
#    project-type: matrix
#    execution-strategy:
#        sequential: false
#        touchstone:
#            expr: '(ARCHITECTURE=="i386" && SUITE=="experimental")'
#            result: stable
#        #combination-filter: '(ARCHITECTURE=="amd64" || SUITE=="experimental")'
#    axes:
#        - axis:
#            type: label-expression
#            name: ARCHITECTURE
#            values:
#                - amd64
#                - i386
#        - axis:
#            type: label-expression
#            name: SUITE
#            values:
#                #- sid
#                - experimental
#    scm:
#        - git:
#            url: 'https://git.torproject.org/tor.git'
#            fastpoll: true
#            branches:
#                - '{branch_name}'
#    builders:
#        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

- job-template:
    name: 'tor-ci-mingwcross-{version}'
    project-type: matrix
    execution-strategy:
        sequential: false
        #touchstone:
        #    expr: '(ARCHITECTURE=="amd64" && SUITE=="jessie")'
        #    result: stable
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - jessie
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            basedir: tor
            branches:
                - '{branch_name}'
    builders:
        - copyartifact:
            project: extern-mingwcross-libevent
            which-build: "last-successful"
        - copyartifact:
            project: extern-mingwcross-openssl
            which-build: "last-successful"
        - copyartifact:
            project: extern-mingwcross-zlib
            which-build: "last-successful"
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT.tor.tar.gz"
        - trigger:
            project: 'tor-ci-mingwcross-{version}-test'
        - trigger:
            project: 'tor-ci-mingwcross-{version}-test-native'
        - notify-tor-irc
        - post-workspace-cleanup

- job-template:
    name: 'tor-ci-mingwcross-{version}-test'
    project-type: matrix
    execution-strategy:
        sequential: false
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - jessie
    scm: []
    builders:
        - copyartifact:
            project: 'tor-ci-mingwcross-{version}'
            which-build: "upstream-build"
            fallback-to-last-successful: true
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

- job-template:
    name: 'tor-ci-mingwcross-{version}-test-native'
    project-type: freestyle
    node: windows
    scm: []
    builders:
        - copyartifact:
            project: 'tor-ci-mingwcross-{version}'
            which-build: "upstream-build"
            fallback-to-last-successful: true
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'

- job-template:
    name: 'tor-ci-windows-{version}'
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - '{branch_name}'
            basedir: tor
    builders:
        - copyartifact:
            project: extern-windows-libevent
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-openssl
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.tor.tar.gz"
        - notify-tor-irc
        - post-workspace-cleanup


- job-template:
    name: 'tor-ci-freebsd-amd64-{version}'
    project-type: freestyle
    node: freebsd-amd64
    scm: []
    builders:
        - shell: '~/jenkins-tools/slaves/other/build-wrapper'

- job:
    name: tor-ci-windows-commit
    project-type: freestyle
    node: windows
    parameters:
        - string:
            name: "COMMIT"
            description: "commit digest"
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - '${COMMIT}'
            basedir: tor
    builders:
        - copyartifact:
            project: extern-windows-libevent
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-openssl
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.tor.tar.gz"
        - notify-tor-irc
        - post-workspace-cleanup



#### nightly .debs
- job-template:
    name: 'tor-debian-{version}-nightly-source'
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
              - '{branch_name}'
              - '{debian_upstream_release_branch}'
            basedir: tor
        - git:
            url: 'https://git.torproject.org/debian/tor.git'
            fastpoll: true
            branches:
                - '{debian_branch}'
            basedir: debian-tor
    builders:
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: 'tor-debian-{version}-nightly-binaries'
        - notify-tor-irc
        - post-workspace-cleanup
- job-template:
    name: 'tor-debian-{version}-nightly-binaries'
    scm: []
    builders:
        - copyartifact:
            project: 'tor-debian-{version}-nightly-source'
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/tor-debian-master-nightly-binaries"
    <<: *execution-strategy-openssl11restriction
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: 'tor-debian-{version}-nightly-install'
        - notify-tor-irc
        - post-workspace-cleanup
- job-template:
    name: 'tor-debian-{version}-nightly-install'
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: 'tor-debian-{version}-nightly-binaries'
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "rsync -v incoming/*/* tordeb@palmeri.torproject.org:-overridden-server-side- && ssh tordeb@palmeri.torproject.org dinstall"

#### .debs: release builds
- job:
    name: tor-debian-release-source
    project-type: freestyle
    node: Linux
    parameters:
        - string:
            name: "DEBIAN_VERSION"
            description: "debian version to build (e.g. 0.2.8.1-alpha-1)"
    scm:
        - git:
            url: 'https://git.torproject.org/debian/tor.git'
            fastpoll: true
            basedir: debian
            branches:
                - "master"
        - git:
            url: 'https://git.torproject.org/debian/tor-pristine-upstream.git'
            fastpoll: true
            basedir: pristine-upstream
            branches:
                - "master"
    triggers: []
    builders:
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper DEBIAN_VERSION"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-release-binaries
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: tor-debian-release-binaries
    scm: []
    builders:
        - copyartifact:
            project: tor-debian-release-source
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/tor-debian-master-nightly-binaries"
    publishers:
        - archive:
            artifacts: "RESULT/*"
        - trigger:
            project: tor-debian-release-install
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: tor-debian-release-install
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: tor-debian-release-binaries
            which-build: "upstream-build"
            flatten: true
            target: incoming
        - shell: "rsync -v incoming/*/* tordeb@palmeri.torproject.org:-overridden-server-side- && ssh tordeb@palmeri.torproject.org dinstall"
###############################################################
### tlsdate
###############################################################
- job:
    name: tlsdate-ci-linux
    scm:
        - git:
            url: 'https://git.torproject.org/tlsdate.git'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
###############################################################
### torsocks
###############################################################
- job:
    name: torsocks-ci-linux
    scm:
        - git:
            url: 'https://git.torproject.org/torsocks.git'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
###############################################################
### stem
###############################################################
- job:
    name: stem-ci-linux
    scm:
        - git:
            url: 'https://git.torproject.org/stem.git'
            fastpoll: true
            branches:
                - master
    execution-strategy:
        sequential: true
        touchstone:
            expr: '(ARCHITECTURE=="amd64" && SUITE=="jessie")'
            result: stable
        combination-filter: '(SUITE!="precise")'
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

- job:
    name: stem-tor-ci-base
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/tor"
        - trigger:
            project: stem-tor-ci
        - notify-tor-irc
        - post-workspace-cleanup

- job:
    name: stem-tor-ci
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/stem.git'
            fastpoll: true
            branches:
                - master
    builders:
        - copyartifact:
            project: stem-tor-ci-base
            which-build: "last-successful"
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - email-ext:
                recipients: atagar@torproject.org
                subject: Build ${BUILD_NUMBER} of stem-tor-ci failed - log attached
                body: ${BUILD_LOG, maxLines=9999, escapeHtml=false}
        - post-workspace-cleanup
###############################################################
### obfsproxy and friends
###############################################################
- job:
    name: pyptlib-ci-linux
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/pluggable-transports/pyptlib'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT.pyptlib.tar.gz"
        - trigger:
            project: obfsproxy-ci-linux
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: obfsproxy-ci-linux
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/pluggable-transports/obfsproxy'
            fastpoll: true
            branches:
                - master
                - test_2_021
    builders:
        - copyartifact:
            project: pyptlib-ci-linux
            which-build: "last-successful"
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"

###############################################################
### external libraries
###############################################################
- job:
    name: extern-windows-libevent
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/libevent.git'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.libevent.tar.gz"
        - trigger:
            project: tor-ci-windows-master
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: extern-windows-openssl
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/openssl.git'
            fastpoll: true
            branches:
                - master
    builders:
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.openssl.tar.gz"
        - trigger:
            project: tor-ci-windows-master
        - trigger:
            project: extern-windows-qt
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: extern-windows-qt
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/qt.git'
            fastpoll: true
            branches:
                - master
    builders:
        - copyartifact:
            project: extern-windows-openssl
            which-build: "last-successful"
        - copyartifact:
            project: extern-windows-zlib
            which-build: "last-successful"
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.qt.tar.gz"
        - trigger:
            project: vidalia-ci-windows
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: extern-windows-zlib
    project-type: freestyle
    node: windows
    scm:
        - git:
            url: 'https://git.torproject.org/extern/zlib.git'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: '~/jenkins-tools/slaves/windows/build-wrapper'
    publishers:
        - archive:
            artifacts: "RESULT.zlib.tar.gz"
        - trigger:
            project: extern-windows-openssl
        - trigger:
            project: extern-windows-qt
        - notify-tor-irc
        - post-workspace-cleanup
###########
- job:
    name: extern-mingwcross-zlib
    project-type: matrix
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - jessie
    scm:
        - git:
            url: 'https://git.torproject.org/extern/zlib.git'
            fastpoll: true
            basedir: zlib
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT.zlib.tar.gz"
        - trigger:
            project: tor-ci-mingwcross-master
        - trigger:
            project: tor-ci-mingwcross-0.2.5
        - trigger:
            project: tor-ci-mingwcross-0.2.6
        - trigger:
            project: tor-ci-mingwcross-0.2.7
        - trigger:
            project: tor-ci-mingwcross-0.2.8
        - trigger:
            project: tor-ci-mingwcross-0.2.9
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: extern-mingwcross-openssl
    project-type: matrix
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - jessie
    scm:
        - git:
            url: 'https://git.torproject.org/extern/openssl.git'
            fastpoll: true
            basedir: openssl
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT.openssl.tar.gz"
        - trigger:
            project: tor-ci-mingwcross-master
        - trigger:
            project: tor-ci-mingwcross-0.2.5
        - trigger:
            project: tor-ci-mingwcross-0.2.6
        - trigger:
            project: tor-ci-mingwcross-0.2.7
        - trigger:
            project: tor-ci-mingwcross-0.2.8
        - trigger:
            project: tor-ci-mingwcross-0.2.9
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: extern-mingwcross-libevent
    project-type: matrix
    axes:
        - axis:
            type: label-expression
            name: ARCHITECTURE
            values:
                - amd64
                - i386
        - axis:
            type: label-expression
            name: SUITE
            values:
                - jessie
    scm:
        - git:
            url: 'https://git.torproject.org/extern/libevent.git'
            fastpoll: true
            basedir: libevent
            branches:
                - master
    builders:
        - shell: "/home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT.libevent.tar.gz"
        - trigger:
            project: tor-ci-mingwcross-master
        - trigger:
            project: tor-ci-mingwcross-0.2.5
        - trigger:
            project: tor-ci-mingwcross-0.2.6
        - trigger:
            project: tor-ci-mingwcross-0.2.7
        - trigger:
            project: tor-ci-mingwcross-0.2.8
        - trigger:
            project: tor-ci-mingwcross-0.2.9
        - notify-tor-irc
        - post-workspace-cleanup
###############################################################
### tor browser manual
###############################################################
- job:
    name: tb-manual
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/tor-browser/user-manual.git'
            fastpoll: true
            basedir: user-manual
            branches:
                - "master"
        - git:
            url: 'https://git.torproject.org/builders/tor-browser-bundle.git'
            fastpoll: true
            basedir: tor-browser-bundle
            branches:
                - "master"
    builders:
        - shell: "SUITE=wheezy ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/html.tar.gz"
        - email-ext:
                recipients: colin@torproject.org
                subject: Build ${BUILD_NUMBER} of tb-manual failed - log attached
                body: ${BUILD_LOG, maxLines=9999, escapeHtml=false}
        - trigger:
            project: tb-manual-install
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: tb-manual-install
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: tb-manual
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "cat incoming/html.tar.gz | ssh torwww@staticiforme.torproject.org jenkins-tb-manual"

###############################################################
### website
###############################################################
- job:
    name: website-build-blog-snippets
    project-type: freestyle
    node: Linux
    scm: []
    triggers:
      - timed: '@daily'
    project-type: freestyle
    node: Linux
    builders:
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/blog-snippets.wmi"
        - trigger:
            project: website-build-webwml
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: website-build-webwml
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/project/web/webwml.git'
            fastpoll: true
            basedir: webwml
            branches:
                - "master"
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - master
            basedir: tor
    builders:
        - copyartifact:
            project: website-build-blog-snippets
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/webwml.tar.gz"
        - trigger:
            project: website-install
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: website-install
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: website-build-webwml
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "cat incoming/webwml.tar.gz | ssh torwww@staticiforme.torproject.org jenkins-website"

###############################################################
- job:
    name: website-staging-build-webwml
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/project/web/webwml.git'
            fastpoll: true
            basedir: webwml
            branches:
                - "staging"
        - git:
            url: 'https://git.torproject.org/tor.git'
            fastpoll: true
            branches:
                - master
            basedir: tor
    builders:
        - copyartifact:
            project: website-build-blog-snippets
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
    publishers:
        - archive:
            artifacts: "RESULT/webwml.tar.gz"
        - trigger:
            project: website-staging-install
        - notify-tor-irc
        - post-workspace-cleanup
- job:
    name: website-staging-install
    project-type: freestyle
    node: master
    scm: []
    builders:
        - shell: 'true'
        - copyartifact:
            project: website-staging-build-webwml
            which-build: "last-successful"
            flatten: true
            target: incoming
        - shell: "cat incoming/webwml.tar.gz | ssh torwww@staticiforme.torproject.org jenkins-website-staging"
###############################################################
### metrics-lib
###############################################################
- job:
    name: metrics-lib-master
    project-type: freestyle
    node: Linux
    scm:
        - git:
            url: 'https://git.torproject.org/metrics-lib.git'
            fastpoll: true
            branches:
                - master
    builders:
        - shell: "SUITE=jessie ARCHITECTURE=amd64 /home/jenkins/jenkins-tools/slaves/linux/build-wrapper"
